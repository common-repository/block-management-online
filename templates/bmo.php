<?php	if (!empty($templatevars['portalpage'])) {		$url = bmo_options::get_option('bmo_portal_url').$templatevars['portalpage'].'.php';	} else {		$url = bmo_options::get_option('bmo_portal_url');	}	if (!empty($_GET['block'])) {		$url .= '?block='.$_GET['block'];		$ampersand = true;	}	if (!empty($_GET['permalink'])) {		if ($ampersand === true) {			$url .= '&';		} else {			$url .= '?';		}		$ampersand = true;		$url .= 'permalink='.$_GET['permalink'];	}	if (($_GET['pp'] == 'account/verify') && !empty($_GET['key']) && !empty($_GET['id'])) {		if ($ampersand === true) 	{			$url .= '&';		} else {			$url .= '?';		}		$url .= 'key='.$_GET['key'].'&id='.$_GET['id'];	}	$ch = curl_init();							// init curl			// if we are logging in then send user name and password as post...	if (!empty($_POST['auth_email']) && !empty($_POST['auth_passw'])) {		$url = bmo_options::get_option('bmo_portal_url').'account/login.php';		curl_setopt($ch, CURLOPT_POST, 1);			// ENABLE HTTP POST		curl_setopt($ch, CURLOPT_POSTFIELDS, 'auth_email='.$_POST['auth_email'].'&auth_passw='.$_POST['auth_passw'].'&loginsubmit=loginsubmit');	} else if ($_GET['pp'] == "messages/index" && !empty($_POST['submit'])) {		curl_setopt($ch, CURLOPT_POST, 1);			// ENABLE HTTP POST		curl_setopt($ch, CURLOPT_POSTFIELDS, 'enquirytype='.$_POST['enquirytype'].'&title='.$_POST['title'].'&content='.$_POST['content'].'&submit='.$_POST['submit']);	} else if ($_GET['pp'] == "account/register" && !empty($_POST['register'])) {		curl_setopt($ch, CURLOPT_POST, 1);			// ENABLE HTTP POST		$post = 'email='.$_POST['email'];		$post .= '&confemail='.$_POST['confemail'];		$post .= '&passw='.$_POST['passw'];		$post .= '&confpassw='.$_POST['confpassw'];		$post .= '&firstname='.$_POST['firstname'];		$post .= '&surname='.$_POST['surname'];		$post .= '&relation='.$_POST['relation'];		$post .= '&affiliation='.$_POST['affiliation'];		$post .= '&register='.$_POST['register'];		curl_setopt($ch, CURLOPT_POSTFIELDS, $post);	} else if ($_GET['pp'] == "account/index" && !empty($_POST['register'])) {		curl_setopt($ch, CURLOPT_POST, 1);			// ENABLE HTTP POST		$post = 'email='.$_POST['email'];		$post .= '&confemail='.$_POST['confemail'];		$post .= '&passw='.$_POST['passw'];		$post .= '&confpassw='.$_POST['confpassw'];		$post .= '&firstname='.$_POST['firstname'];		$post .= '&surname='.$_POST['surname'];		$post .= '&relation='.$_POST['relation'];		$post .= '&affiliation='.$_POST['affiliation'];		$post .= '&register='.$_POST['register'];		curl_setopt($ch, CURLOPT_POSTFIELDS, $post);	} else if ($_GET['pp'] == "account/passwordreset" && !empty($_POST['passwordreset'])) {		curl_setopt($ch, CURLOPT_POST, 1);			// ENABLE HTTP POST		$post = 'auth_email_send='.$_POST['auth_email_send'];		$post .= '&passwordreset='.$_POST['passwordreset'];		curl_setopt($ch, CURLOPT_POSTFIELDS, $post);	}	curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);	curl_setopt($ch, CURLOPT_URL, $url);	// Set the URL to work with		curl_setopt($ch, CURLOPT_HEADER, 1);		curl_setopt($ch, CURLOPT_COOKIEFILE, "");//	curl_setopt($ch, CURLOPT_COOKIEFILE, plugin_dir_path(__FILE__).'cookies/cookie.txt');		// Handle cookies for the login//	curl_setopt($ch, CURLOPT_COOKIEJAR, plugin_dir_path(__FILE__).'cookies/cookie.txt');		// Handle cookies for the login	curl_setopt($ch, CURLOPT_COOKIE,  $bmo_session->bmo_cookies);	// Setting CURLOPT_RETURNTRANSFER variable to 1 will force cURL	// not to print out the results of its query.	// Instead, it will return the results as a string return value	// from curl_exec() instead of the usual true/false.	curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);		$store = curl_exec($ch);	// execute the request (the login)	curl_close($ch);		preg_match_all('|Set-Cookie: (.*);|U', $store, $results);   	$bmo_session->bmo_cookies = implode(';', $results[1]);			$bmo_session->save_session_vars();		if (($pos = stripos($store, '<!-- bmo_start -->')) === false) {		echo $store;	} else {		echo substr($store, $pos);	}?>